# Spring(인프런) - 빈 스코프

## 빈 스코프 & 빈 스코프 종류
- 빈이 존재할 수 있는 범위
- 싱글톤 : 기본 스코프, 스프링 컨테이너의 시작과 종료까지 유지되는 가장 넓은 범위의 스코프
- 프로토타입 : 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 스코프
- 웹 관련 스코프
    - request : 웹 요청이 들어오고 나갈 때 까지 유지되는 스코프
    - session : 웹 세션이 생성되고 종료될 때 까지 유지되는 스코프
    - application : 웹의 서블릿 컨텍스트와 같은 범위로 유지되는 스코프

## 프로토타입 스코프의 요청 과정
1. 프로토타입 스코프의 빈을 스프링 컨테이너에 요청
2. 스프링 컨테이너는 이 시점에 프로토타입 빈을 생성 후 의존관계를 주입한다.
3. 클라이언트에 반환
4. 이후에 요청이 들어와도 항상 새로운 프로토타입 빈을 생성해서 반환
- 프로토타입로 설정한 경우 빈을 생성하고, 의존관계 주입, 초기화까지만 처리

## 프로토타입 빈의 특징
- 스프링 컨테이너에 요청할 때마다 새로 생성된다.
- 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입 그리고 초기화까지만 관여
- 프로토타입의 빈은 클라이언트가 관리해야 한다. 종료 메서드 호출도 클라이언트가 직접한다.

## 싱글톤과 프로토타입을 동시 사용 시 문제점
- 스프링은 일반적으로 싱글톤 빈을 사용하므로 프로토타입을 설정하게 되면 싱글톤 빈이 프로토타입 빈을 사용하게 한다.
- 싱글톤 빈이 생성될 때 의존관계 주입으로 인해 프로토타입 빈이 생성되지만 싱글톤 빈과 동시에 유지되는 것이 문제이다.
- ObjectProvider를 사용하여 문제를 해결할 수 있다.
- ObjectProvider : 지정한 빈을 컨테이너에서 대신 찾아주는 DL정도의 기능을 제공한다.

## 웹스코프
- 프로토타입과 다르게 스프링이 해당 스코프 종료까지 관리한다. -> 종료 메서드가 호출됨
- 종류
    - request : HTTP 요청 하나가 들어오고 나갈 때 까지 유지되는 스코프
    - session : HTTP 세션과 동일한 생명주기
    - application : 서블릿 컨텍스트와 동일한 생명주기
    - websocket : 웹 소켓과 동일한 생명주기를 가지는 스코프
