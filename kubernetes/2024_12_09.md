# 쿠버네티스
## ETCD in Kubernetes
ETCD는 쿠버네티스에서 클러스터 상태와 구성 데이터를 저장하고 관리하는 핵심 데이터 스토어이다. 직접 설치하거나 Kubeadm을 통해 배포할 수 있으며, 고가용성 환경에서는 여러 인스턴스 간의 연결과 설정이 중요하다. 이 과정에 대해 자세하게 알아보자

### ETCD의 역할
- 쿠버네티스 클러스터의 정보를 저장 (nodes, pods, ConfigMaps, secrets, accounts, roles, role bindings 등)
- kubectl get 명령어로 표시되는 정보는 모두 etcd 서버에서 가져옴
- 클러스터에 추가되는 모든 변경 사항은 ETCD에 업데이트 되어야 변경이 완료된다.

### ETCD 배포방법
- 직접 배포
  - etcd 바이너리를 다운로드 및 설치 후 마스터 노드에 직접 서비스로 설정
  - 인증서 생성 및 설정 필요
  - etcd를 클러스터로 구성하는 방법 고가용성(High Availability) 설정 시 이 옵션들에 대해 더 자세히 살펴보자
  - 현재는 advertised client URL 설정을 우선 알아두자
  - advertised client URL 설정은 etcd가 요청을 받을 주소를 나타내며, 일반적으로 해당 서버의 IP와 기본 포트인 2379 포트를 사용  
  쿠버네티스 API 서버가 etcd 서버에 접근할 때 이 URL을 사용하게 됩니다.
- Kubeadm을 통해 배포
  - etcd가 쿠버네티스 시스템 네임스페이스(kube-system)의 파드로 배포됨
  - 파드 내부에서 etcdctl 명령어를 사용해서 etcd DB 탐색 가능

### 데이터 구조
- etcd는 /registry를 최상위 디렉토리로, 그 아래 nodes, pods, replica sets, deployments 등이 위치

### 고가용성(High Availability)
- 여러 마스터 노드와 그 위에 배포된 여러 etcd 인스턴스가 존재
- etcd 인스턴스 간의 연결을 위해 initial-cliuster 옵션 설정 필요
- 고가용성 설정과 관련된 세부 사항은 후반부 강의에서 다룬다

## Docker와 containerd, 그리고 Kubernetes

Docker는 컨테이너 생태계를 연 de-facto 표준 도구였고, 그 안에는 실제 컨테이너를 실행하는 runc와 그 위에서 컨테이너를 관리하는 데몬인 containerd가 함께 들어 있었다. 이후 containerd가 CRI(컨테이너 런타임 인터페이스)를 지원하게 되면서, Kubernetes는 Docker를 거치지 않고도 containerd와 직접 통신할 수 있게 되었다.

- 예전에는 “Docker 엔진 + 도커 데몬” 전체가 Kubernetes의 컨테이너 런타임 역할을 했다.
- 현재는 containerd, CRI-O 같은 CRI 호환 런타임이 곧바로 Kubernetes와 연동되므로 Docker 고유 기능(Docker CLI, Docker API, 도커 볼륨/빌드 등)은 필수가 아니다.
- 그래서 흔히 말하는 "Docker 지원 deprecated"는 **쿠버네티스가 런타임으로서 Docker 엔진을 더 이상 요구하지 않는다**는 뜻이지, Docker라는 도구가 완전히 사라졌다는 의미는 아니다.
- 이 노트에서 컨테이너 예시를 Docker 기준으로 설명해도 개념 이해에는 문제 없고, 실제 환경이 containerd-only라면 대부분의 경우 `docker` 대신 `crictl`, `nerdctl` 같은 도구로 유사하게 실습할 수 있다.

## Reference
Udemy 강의 : Certified Kubernetes Administrator (CKA) with Practice Tests
