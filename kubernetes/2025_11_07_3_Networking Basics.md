# 쿠버네티스

## Networking Basics

### 개요
이번 시리즈에서는 스위칭, 라우팅, 게이트웨이 같은 네트워크 기초 개념을 다지고 DNS와 CoreDNS, 리눅스에서의 DNS 설정 방법, 리눅스 네트워크 네임스페이스 기본까지 살펴본다. OSI 7계층 이론을 깊게 파기보다는 이후 강의를 이해할 만큼만 실습 위주로 다루며, 시스템 관리자의 시각과 애플리케이션 개발자의 시각에서 명령어 사용법을 익힌다. 이미 리눅스 네트워킹에 익숙하다면 건너뛰어도 된다.

### 네트워크란 무엇인가
두 시스템 A와 B가 있을 때 스위치에 연결하면 두 시스템을 포함한 하나의 네트워크가 만들어진다. 각 호스트에는 물리·가상 형태의 네트워크 인터페이스가 필요하며 `ip link` 명령으로 확인할 수 있다. 예를 들어 `eth0` 인터페이스를 사용하고 네트워크 주소가 192.168.1.0이라면 `ip addr` 명령으로 각 호스트에 같은 네트워크 대역의 IP를 부여한다. 링크가 활성화되고 IP가 설정되면 스위치를 통해 서로 통신할 수 있다. 스위치는 같은 네트워크 안에서만 패킷을 전달한다.

### 라우터와 게이트웨이
네트워크 192.168.2.0에 시스템 C와 D가 있고 B(192.168.1.11)에서 C(192.168.2.1)로 통신하려면 라우터가 필요하다. 라우터는 여러 네트워크를 잇는 지능형 장비로 각 네트워크에 하나씩 IP를 가진다(예: 192.168.1.1, 192.168.2.1). 각 호스트는 패킷을 어디로 보낼지 알기 위해 게이트웨이나 경로를 설정해야 한다. 게이트웨이는 다른 네트워크로 나가는 문과 같다.

### 라우팅 테이블과 기본 게이트웨이
`route` 명령은 커널 라우팅 테이블을 보여준다. 아무 경로가 없으면 192.168.1.0 대역의 호스트 B는 192.168.2.0 대역으로 갈 수 없다. `ip route add`를 사용해 "192.168.2.0 대역은 192.168.1.1을 통해 나간다"라고 지정하면 라우팅 테이블에 항목이 추가되고 통신이 가능해진다. 반대로 C에서도 1.0 네트워크로 가는 경로를 2.1 게이트웨이로 추가해야 한다. 인터넷과 통신하려면 라우터를 인터넷에 연결한 뒤 172.27.194.0 같은 외부 네트워크를 라우터를 통해 전달하도록 경로를 넣는다. 인터넷 전체에 대해 일일이 경로를 생성하기보다는 알 수 없는 목적지에 대해 사용할 기본 게이트웨이(default 또는 0.0.0.0)를 지정하는 것이 일반적이다. 내부망과 외부망을 위한 라우터가 여러 개라면 네트워크별 경로와 기본 게이트웨이를 각각 설정한다. 인터넷 연결이 되지 않을 때는 라우팅 테이블과 기본 게이트웨이를 가장 먼저 점검한다.

### 리눅스 호스트를 라우터로 구성하기
호스트 A와 B가 192.168.1.0, B와 C가 192.168.2.0 네트워크로 연결되고 B가 두 인터페이스(eth0, eth1)를 가진 경우 A(192.168.1.5)와 C(192.168.2.5)가 서로 통신하려면 라우팅 설정이 필요하다. A에는 "192.168.2.0 대역은 192.168.1.6(B)", C에는 "192.168.1.0 대역은 192.168.2.6(B)"이라는 경로를 추가한다. 그래도 응답이 없으면 IP 포워딩이 비활성화된 것이다. 리눅스는 기본적으로 인터페이스 간 포워딩을 막아 두는데, `/proc/sys/net/ipv4/ip_forward` 값을 1로 바꾸면 포워딩이 활성화된다. 단, 재부팅 후에도 유지하려면 `/etc/sysctl.conf`에 동일한 설정을 추가해야 한다.

### 핵심 명령어 정리
- `ip link`: 호스트의 네트워크 인터페이스 조회 및 수정
- `ip addr` / `ip addr add`: 인터페이스에 할당된 IP 확인 및 설정 (재부팅 후 유지하려면 네트워크 설정 파일에 반영)
- `route` 또는 `ip route`: 라우팅 테이블 조회
- `ip route add`: 라우팅 테이블에 경로 추가
- `/proc/sys/net/ipv4/ip_forward` 확인: 호스트가 라우터로 동작 가능한지 확인하고 필요 시 `sysctl` 설정으로 영구화
