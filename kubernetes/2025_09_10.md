# 쿠버네티스

## Kubernetes TLS Basic

### TLS 인증서의 목적
인증서는 거래 과정에서 두 당사자 간의 신뢰를 보장하는데 사용된다.  
예를 들어 사용자가 웹 서버에 접근할 때, TLS 인증서는 사용자와 서버 간의 통신이 암호화되어 안전하고, 서버가 자신이 주장하는 진짜 서버임을 확인시켜 준다.

### 대칭키 암호화 (Symmetric Encryption)
- 데이터는 임의의 숫자/문자 조합으로 이루어진 키를 사용해 암호화 된다
- 서버가 데이터를 읽으려면 동일한 키가 필요하므로, 키도 네트워크를 통해 서버로 전송해야 한다.
- 해커가 이 키를 가로챌 수 있어 취약하다.

### 비대칭키 암호화 (Asymmetric Encryption)
- 대칭키 암호와의 문제를 해결하기 위해 키 쌍(Private Key, Public Key)을 사용
  - 개인키 (Private key): 본인만 소유해야 하며 절대 공유하지 않음
  - 공개키 (Public key): 누구나 사용할 수 있음
- 공개키로 암호화된 데이터는 해당 개인키로만 복호화할 수 있다.

### SSH 예제 (Key-pair 사용)
- 사용자는 ssh-keygen 명령어로 개인키(id_rsa)와 공개키(id_rsa.pub)를 생성한다
- 서버는 사용자의 공개키를 authorized_keys에 등록하여 접근을 허용한다
- 사용자는 자신의 개인키로만 서버에 접속할 수 있다
- 다른 서버에도 동일한 공개키를 복사해 두면, 하나의 개인키로 여러 서버에 안전하게 접속할 수 있다
- 여러 사용자가 필요하면, 각각의 공개키를 추가해 다중 사용자 인증도 가능

### HTTPS (웹 서버) 예제
- 대칭키 전송 과정의 위험을 해결하기 위해 비대칭키를 사용
- 서버는 공개키와 개인키를 생성하고, 사용자는 서버의 공개키를 받는다
- 사용자는 대칭키를 서버의 공개키로 암호화해 전송
- 서버는 개인키로 이를 복호화해 대칭키를 얻는다
- 연결이 되면 대칭키 기반 암호화를 통해 통신할 수 있음

### 인증서(Certificate)의 필요성
- 만약 해커가 가짜 웹 사이트를 만들었다면, 스스로 키 쌍을 생성해 배포할 수 있는 문제가 발생
- 이 문제를 해결하기 위해 서버는 단순한 공개키가 아니라 인증서를 제공
- 인증서에는 서버의 정보(도메인, 공개키 등)가 포함
- 가장 중요한 항목은 누가 인증서를 발급했는지가 제일 중요

### 인증기관 (CA, Certificate Authority)
- 스스로 발급한 인증서는 Self-signed Certificate로 신뢰할 수 없다
- 신뢰할 수 있는 제3자인 CA가 서버의 인증서를 검증하고 서명한다
- 브라우저는 내장된 CA들의 공개키를 이용해 서버 인증서를 검증
- 대표적인 CA: Symantec, DigiCert, Comodo, GlobalSign 등

### CSR (Certificate Signing Request)
- 서버 관리자는 먼저 키를 생성한 후 CSR(인증서 서명 요청)파일을 만든다
- 이 파일을 CA에 제출하면, CA가 검증 후 인증서에 서명해 돌려준다
- 서버는 이 CA 서명된 인증서를 웹 서버에 설정한다
- 브라우저는 인증서 체인을 따라가며 CA까지 검증하므로, 사용자가 신뢰할 수 있다