# 쿠버네티스

## Kubernetes 환경 변수 설정 방법
- env 속성 사용 (배열 형태)
  - 각 항목은 - name: 변수명, value: 값 형태
- 직접 지정: key-value 쌍으로 바로 설정
- 간접 지정: valueForm으로 ConfigMap 또는 Secret 참조

## Configuring ConfigMaps in Applications

### ConfigMap의 역할
- Pod 정의 파일 안에 직접 환경 변수를 작성하면, Pod 개수가 많아질수록 관리가 어려움
- ConfigMap을 사용하면 환경 변수를 중앙에서 관리 가능
- ConfigMap은 키-값 쌍 형태로 데이터를 저장하고, Pod 실행 시 환경 변수나 파일로 주입 가능

### 생성 방법
- 명령형 (Imperative)
  - 정의 파일 없이 명령어로 바로 생성
  - --from-literal: 명령줄에서 직접 키-값 지정
  ```
    kubectl create configmap app-config --from-literal=app_color=blue
  ```
  - 여러개 지정 시 --from-literal 반복
  - --from-file: 파일의 내용을 읽어 저장 -> 파일 이름이 key로, 파일 내용이 value로 사용됨

- 선언형 (Declarative)
  - YAML 정의 파일 작성 후 생성
    ```
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: app-config
      data:
        app_color: blue
    ```
  - 실행
    ```
      kubectl create -f configmap-definition.yaml
    ```

### ConfigMap 조회
- kubectl get configmaps: ConfigMap 목록 확인
- kubectl describe configmap app-config: 데이터 내용 확인

### Pod에 ConfigMap 주입
- Pod 정의 파일에서 envFrom 속성 사용
  ```
    envFrom:
      - configMapRef:
          name: app-config
  ```
- envFrom은 배열 형태 -> 여러 ConfigMap 참조 가능
- ConfigMap의 모든 key가 환경 변수로 주입됨

### 다른 주입 방식
- 단일 환경 변수 주입: env에서 valueFrom.configMapKeyRef 사용
- 파일 형태로 주입: Volume에 마운트하여 Pod 내부에서 파일로 사용

### 활용 팁 
- ConfigMap은 여러 개 생성 가능 -> 서비스별, 기능별로 나눠 관리
- 이름을 직관적으로 지정해야 Pod 연결 시 혼동 방지
- 환경 변수 주입 외에도 설정 파일, 외부 서비스 연결 정보 등 관리 가능