# 쿠버네티스

## KubeConfig

### kubeconfig란?
- kubectl 명령에서 매번 --server, --client-certificate, --client-key, --certificate-authrity 옵션을 입력하지 않기 위해 사용하는 구성 파일
- 이 파일에는 클러스터 접속 정보, 사용자 인증 정보 그리고 이 둘을 연결하는 context가 정의되어 있다
- default 위치는 ~/.kube/config 이며, kubectl은 자동으로 이 파일을 참조한다. (별도 지정 시 --kubeconfig <path> 옵션 사용)

### 구성 요소 (3대 색션)
| 색션 | 설명 |
|-----|--------------|
| clusters | 접근할 kubernetes 클러스터의 목록과 설정 정보, 예: 개발, 테스트, 운영, 클라우드 별 클러스터 등. 항목에는 name, server 주소, certificate-authority(CA 인증서 경로 또는 base64 데이터)가 포함됨 |
| users | 해당 클러스터에 접근할 사용자 계정과 인증 정보. 예: admin, dev, prod-user 등. 항목에는 client-certificate(사용자 인증서), client-key(개인키) 경로 또는 base64 데이터가 포함됨 |
| context | 어떤 사용자가 어떤 클러스터에 접근할지를 연결. 예: admin@production. dev@google.cluster, user, 선택적으로 namespace를 지정할 수 있음 |
- 위 과정은 새로운 사용자를 생성하는 것이 아니라, 기존 사용자와 클러스터를 연결하여 kubectl 명령이 어떤 자격으로 실행될지 정의하는 것

### 기본 구조 (yaml 예시)
```
  apiVersion: v1
  kind: Config

  clusters:
  - name: mykube-playground
    cluster:
      server: https://192.168.99.100:8443
      certificate-authority: /etc/kubernetes/pki/admin.key
    
    contexts:
    - name: mykube-playground
      context:
        cluster: mykube-playground
        user: mykube-admin
        namespace: development

    current-context: myjube-admin@mykube-playground
```
- clusters. users, contexts는 모두 배열 형태이므로 여러 항목을 한 파일에 넣을 수 있다
- current-context는 kubectl이 기본적으로 사용할 context를 지정한다

### 주요 명령어 (kubectl config)
| 명령 | 설명 |
|-----|-----|
| kubectl config view | 현재 kubeconfig의 전체 내용 보기 |
| kubectl config use-context <name> | 현재 context 변경 |
| kubectl config -set-context /unset/delete-context | context 추가, 수정, 삭제 |
| kubectl config current-context | 현재 사용 중인 context 확인 |

- kubectl config 명령으로 변경한 내용은 실제 ~/.kube/config 파일에 반영된다

### namespace 설정
- 각 context에 namespace 필드를 추가할 수 있다.
```
  namespace: dev
```
- 이렇게 설정하면 해당 context로 전환 시 자동으로 dev 네임스페이스에 연결된다

### kubeconfig에서 인증서를 지정하는 두 가지 방법
1. 파일 경로 방식
```
  certificate-authority: /etc/kubernetes/pki/ca.crt
  client-certificate: /etc/kubernetes/pki/admin.crt
  client-key: /etc/kubernetes/pki/admin.key
```
2. Base64 인코딩 데이터 방식
```
  certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0t...
```
  - 인코딩된 내용을 복호화 하는 방법
    ```
      base64 --decode
    ```