# 쿠버네티스

## Designing a Kubernetes Cluster

### 목표/환경 정의 질문
- 목적: 학습/개발/테스트/프로덕션 중 무엇인가?
- 운영 형태: 클라우드 매니지드(GKE/EKS/AKS) vs 자체 호스팅(kubeadm 등)
- 워크로드: 웹/배치/빅데이터/애널리틱스 등 유형과 리소스 요구량
- 트래픽 특성: 지속 고트래픽 vs 버스트형, 외부 노출 필요성
- 애플리케이션 수: 소수 vs 다수(멀티테넌시/네임스페이스 전략)

### 배포 옵션 요약
- 학습용: Minikube, 싱글 노드 kubeadm(로컬 VM/클라우드)
- 개발/테스트: 멀티 노드(단일 컨트롤 플레인 + 다수 워커), kubeadm 또는 GKE/EKS/AKS의 소형 클러스터
- 프로덕션: 다중 컨트롤 플레인(HA) + 다수 워커, kubeadm/각 CSP 매니지드, AWS는 kOps 같은 도구도 가능

### 대규모 한계(권장 가이드)
- 최대 노드: ~5,000
- 최대 파드: ~150,000 (컨테이너 ~300,000), 노드당 파드 ~100
- 숫자는 버전/환경에 따라 달라질 수 있으므로 최신 문서 참조

### 노드/인스턴스 사이징
- 클라우드 매니지드는 노드 수에 따라 적절한 타입을 추천/선택
- 온프렘은 예상 파드 밀도, CPU/메모리/네트워크 대역, 디스크 IOPS를 기준으로 산정(초기 가이드 → 워크로드 모니터링 후 조정)

### 스토리지 설계
- 성능 요구: SSD 기반 디스크 선호, IOPS/지연시간 고려
- 공유 접근: 네트워크 스토리지(CSI 드라이버) 검토
- 영속성: PV/PVC, StorageClass로 클래스 분리(예: fast/standard/archive)

### 토폴로지와 운영 팁
- 노드 형태: 물리/가상/클라우드 모두 가능(예시: 1 컨트롤 플레인 + 2 워커 구성)
- 컨트롤 플레인 전용화: 마스터 노드에 taint 부여(kubeadm 기본) → 워크로드 스케줄 방지
- OS: 64-bit Linux 권장
- etcd 분리: 대규모/고가용성 요구 시 etcd 전용 클러스터 분리 고려

### 클러스터 유형별 권장 패턴
- 학습: 단일 노드, 로컬 스토리지, 간단한 CNI
- 개발/테스트: 멀티 노드, 오토스케일 테스트, 간단한 Ingress/Gateway 구성
- 프로덕션: 다중 컨트롤 플레인, 멀티 AZ/존, 백업/복구 계획, 모니터링/로깅, 네트워크 정책, RBAC/시크릿 관리, Ingress/Gateway, 레지스트리 전략

### 마무리
- 핵심 수치 암기는 불필요. 공식 문서/레퍼런스를 실사용 전 최신화.
- 다음 단계: kubeadm 또는 클라우드 매니지드로 실제 클러스터를 프로비저닝하고, 네트워킹/스토리지/보안 기본 설정을 검증한다.

---

## 배포 옵션 상세(실전 가이드)

### 로컬/랩톱 환경
- Linux 수동 설치: 바이너리 직접 설치로 로컬 클러스터 구성 가능(학습 목적 외에는 비추천). 초기 학습엔 자동화 도구 권장.
- Windows: 네이티브 쿠버네티스는 불가. Hyper‑V/VMware/VirtualBox로 Linux VM을 만든 뒤 실행. Docker 기반 솔루션도 내부적으로 Linux VM을 사용.
- Minikube: 단일 노드 클러스터를 손쉽게 구성. 하이퍼바이저(예: VirtualBox)에 VM을 자동 생성/관리.
- kubeadm: 단일/다중 노드 모두 가능하나, VM/호스트는 사용자가 미리 준비해야 함. 전개 속도 빠르고 학습·테스트·소규모 프로덕션까지 범용.

### 턴키(On‑prem/자체) 솔루션
- OpenShift: Red Hat의 엔터프라이즈 쿠버네티스. GUI, CI/CD 통합, 보안·운영 기능을 추가 제공.
- Cloud Foundry Container Runtime(CFCR): BOSH를 통해 고가용성 K8s 배포/운영 자동화.
- VMware 기반 솔루션: 기존 vSphere/가상화 자원을 활용해 K8s 클러스터 구성(예: Tanzu 제품군 등).
- Vagrant 스크립트: 멀티 클라우드/온프렘에 반복 가능한 클러스터 프로비저닝 자동화.
- 특징: VM 패치/업그레이드는 직접 책임지되, 도구가 클러스터 구성·운영을 단순화.

### 호스티드/매니지드 클라우드(Kubernetes as a Service)
- GKE(Google Kubernetes Engine)
- EKS(Amazon Elastic Kubernetes Service)
- AKS(Azure Kubernetes Service)
- OpenShift Online 등
- 특징: 컨트롤 플레인/노드 수명주기 관리가 자동화되어 수분 내 프로비저닝 가능. 버전 업그레이드/패치가 용이.

### 학습용 설계 예(강의 시나리오)
- 제약: 퍼블릭 클라우드 계정 없이도 가능해야 함, 로컬 선호(설문 결과).
- 선택: VirtualBox에 VM 여러 대 생성 후 kubeadm으로 “1 컨트롤 플레인 + 2 워커” 구성.
- 목적: 로컬에서도 실 프로비저닝/조인/네트워킹/스토리지를 끝단까지 경험.
