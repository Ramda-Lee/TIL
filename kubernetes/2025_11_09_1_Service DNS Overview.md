# 쿠버네티스

## Service DNS

### 개용
- 본 강의는 쿠버네티스 클러스터 내부 DNS 이름 체계를 설명한다. 외부 DNS·노드 이름 등록 등은 범위 밖이며, `nslookup`, `dig`, `/etc/hosts`, `/etc/resolv.conf` 같은 선행 지식이 있다고 가정한다.
- 목표: 서비스·파드에 어떤 DNS 이름이 부여되는지, 서로를 어떤 경로로 조회하는지 이해하는 것. 다음 강의에서 CoreDNS 구현을 다루기 때문에, 여기서는 “이름이 어떻게 구성되는지”에 집중한다.

### 서비스 레코드 생성 흐름
1. 클러스터 네트워킹이 정상 구성되어 각 파드·서비스가 고유 IP를 갖는다고 가정한다.
2. 예시: `test` 파드(10.234.1.5)가 `web` 파드(10.244.2.5)를 호출해야 하므로 `web-service`라는 Service를 생성하고 ClusterIP(예: 10.107.37.188)를 부여한다.
3. Service 생성 이벤트를 감지한 쿠버네티스 DNS(CoreDNS/kube-dns)가 `web-service` 이름과 ClusterIP를 매핑하는 레코드를 만든다.
4. 같은 네임스페이스라면 `web-service`만으로 접근 가능하지만, 다른 네임스페이스에서 접근하려면 `web-service.apps`처럼 “서비스명.네임스페이스”를 사용한다.

### 서비스 FQDN 규칙
```
<service-name>.<namespace>.svc.cluster.local
```
- 네임스페이스별로 서브도메인을 만들어 객체를 그룹화한다.
- `svc` 서브도메인은 모든 서비스 레코드를 묶는 용도다.
- 루트 도메인은 기본적으로 `cluster.local`이며 클러스터 구성 시 변경할 수 있다.
- 따라서 `apps` 네임스페이스의 `web-service`는 `web-service.apps.svc.cluster.local`이라는 FQDN을 가진다.

### 파드 레코드 (선택 기능)
- 기본 설정에서는 파드에 대한 DNS 레코드를 만들지 않는다. CoreDNS ConfigMap에서 `pods` 옵션을 활성화하면 생성된다.
- 파드 이름이 아니라 **파드 IP의 점(.)을 대시(-)** 로 치환한 문자열을 호스트명으로 사용한다.
  - 예: `10.244.2.5` → `10-244-2-5.apps.pod.cluster.local`
- 네임스페이스와 루트 도메인은 서비스와 동일한 규칙을 따른다. `pod` 서브도메인을 사용해 서비스 레코드와 구분한다.

### 요약
- 쿠버네티스는 Service 생성 시 자동으로 DNS 레코드를 만든다.
- 같은 네임스페이스에서는 서비스 “이름”만으로 접근 가능하지만, 다른 네임스페이스·전체 FQDN이 필요한 경우 `svc.cluster.local` 구조를 따른다.
- 파드 레코드는 기본적으로 비활성화되어 있으며, 필요하면 CoreDNS 설정을 수정해 IP 기반 호스트명을 사용할 수 있다.
- 다음 강의에서는 이러한 레코드를 실제로 제공하는 CoreDNS가 어떻게 배포·구성되는지 다룬다.
