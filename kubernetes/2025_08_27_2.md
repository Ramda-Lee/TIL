# 쿠버네티스

## Kubernetes Horizontal Pod Autoscaler

### 수동 스케일링
- kubectl top pod -> 리소스 사용량 확인 (다만, metrics-server 필요)
- 임계치 도달 시 -> kubectl sacle로 pod 개수 조정
- 문제점:
  - 지속 모니터링 필요
  - 갑작스러운 트래픽 증가에 대응 어려움

### HPA 개념
- 자동으로 pod 개수 조정
- 기준: CPU, 메모리, 커스텀/외부 메트릭
- 부하가 늘면 -> pod 증가 / 부하가 줄면 -> pod 감소
- 최소/최대 pod수를 보장

### 명령어 예시
```
  # HPA 생성 (임계치 CPU 50%, 최소 1, 최대 10 pod)
  kubectl autiscale deployment my-app --cpu-percent=50 --min=1 --max=10
  # HPA 상태 확인
  kubectl get hpa
  # HPA 삭제
  kubectl delete hpa my-app
```

### yaml 적용 예시
```
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: my-app-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: my-app
  minReplicas: 1
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 50
```

### 전제 조건 & 확장
- kubernetes v1.23 이상 -> HPA 내장
- metrics-server 필수
- 메트릭 소스
  - 내부 메트릭: metrics-server
  - 커스텀 메트릭: Custom Metrics Adapter
  - 외부 메트릭: Datadog, Dynatrace (시험에 나오진 않음)