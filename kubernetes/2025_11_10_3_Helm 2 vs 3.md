# 쿠버네티스

## Helm 2 vs 3 (주요 변화)

### 간단 연혁
- Helm 1.0: 2016-02
- Helm 2.0: 2016-11
- Helm 3.0: 2019-11
- 쿠버네티스의 RBAC/CRD 등 발전과 함께 Helm도 성숙해지며 설계가 단순·안전·지능적으로 개선됨.

### 핵심 변화 요약
- Tiller 제거(Helm 3): 중간 컴포넌트 없이 바로 Kubernetes API와 통신
- RBAC 연동 강화: kubectl과 동일하게 사용자 권한을 쿠버네티스 RBAC로 통합 관리
- 3-way Strategic Merge Patch: "되돌릴 차트", "현재 차트", "실시간(Live) 상태" 3가지를 비교해 변경을 더 똑똑하게 병합/복원
- 리비전 기반 릴리스 관리 개선: 롤백/업그레이드 시 Live 상태 고려 → 수동 변경 보존 가능성↑

### Helm 2: 왜 Tiller가 필요했나
- 당시 쿠버네티스에는 RBAC/CRD 등이 충분하지 않았음.
- Helm CLI → Tiller(클러스터 내 서버 사이드) → Kubernetes 구조로 동작.
- Tiller는 기본적으로 광범위 권한(God mode)에 가까워 보안 우려와 운영 복잡성을 증가시킴.

### Helm 3: Tiller 제거와 보안 단순화
- Tiller 완전 제거, Helm CLI가 바로 Kubernetes와 통신.
- 권한은 쿠버네티스 RBAC로 일원화: kubectl이든 helm이든 동일 사용자라면 동일 권한이 적용됨.
- 도구가 무엇이든, 허용된 범위 내에서만 리소스 변경 가능.

### 리비전과 롤백 동작
- 설치 시 리비전 1 생성, 업그레이드 시 리비전 2, 롤백 시에도 새로운 리비전이 생성됨.
- Helm 2: 롤백은 "현재 차트" vs "이전 차트"만 비교.
  - 사용자가 `kubectl set image` 등으로 수동 변경한 Live 상태는 모름 → 롤백에 반영되지 않을 수 있음.
- Helm 3: 3-way Strategic Merge Patch 사용.
  - "되돌릴 차트(리비전)", "현재 차트", 그리고 "Live 상태"를 모두 비교.
  - 예: Live 이미지는 5.8, 리비전1은 4.8 → 차이를 인지하고 4.8로 되돌림.

### 업그레이드 시 차이
- Helm 2: 차트 외부에서 가한 Live 변경이 업그레이드 시 덮어씌워질 수 있음.
- Helm 3: Live 상태도 함께 고려하여, 사용자가 추가한 필드/설정을 가능한 범위에서 보존하며 업그레이드.

### 실무 포인트
- 온라인 문서/블로그/차트는 Helm 2와 Helm 3 내용이 혼재함 → 버전 전제 확인 필수.
- 신규 프로젝트/운영은 Helm 3를 기본으로 사용 권장.

### 요약
- Tiller 유무: Helm 2(O) → Helm 3(X)로 단순화.
- 권한/보안: Helm 3는 쿠버네티스 RBAC와 직접 연동해 보안 모델이 명확.
- 병합 전략: Helm 3의 3-way Strategic Merge Patch로 롤백/업그레이드 신뢰성 향상.
- 결론: Helm 3는 더 단순하고 안전하며, Live 상태를 반영해 변경 손실을 줄인다.
