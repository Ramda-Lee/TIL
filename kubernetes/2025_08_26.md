# 쿠버네티스

## Kubernetes InitContainers

### InitContainers
- Multi Container Pods에서는 각 컨테이너가 파드의 라이프 사이클 동안 살아 있는 프로세스를 실행해야 한다
- 때로는 컨테이너 안에서 완료될 때까지 실행되는 프로세스가 필요할 경우가 있다 -> pod가 처음 한번만 실행되야할 경우
- 이때 사용하는 것이 InitContainer

### InitContainer 정의 예시
- InitContainer는 다른 컨테이너와 동일하게 pod 내에서만 정의되지만, initContainers 섹션 안에 저장된다
```
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: busybox:1.28
    command: ['sh', '-c', 'echo The app is running! && sleep 3600']
  initContainers:
  - name: init-myservice
    image: busybox
    command: ['sh', '-c', 'git clone <some-repository-that-will-be-used-by-application> ; done;']
```
- pod가 처음 생성될 때 InitContainer가 실행되며, InitContainer의 프로세스가 완전히 종료된 후에애 실제 어플리케이션을 포스팅하는 컨테이너가 시작된다

### 다중 InitContainer 설정
- 여러개의 InitContainer를 설정할 수 있다. 각 InitContainer가 순차적으로 실행된다
- 여러개 InitContainer중 하나라도 완료되지 못하면, 쿠버네티스는 해당 InitContainer가 성공할 때까지 pod를 계속해서 재시작 한다.
```
apiVersion: v1
kind: Pod
metadata:
  name: myapp-pod
  labels:
    app: myapp
spec:
  containers:
  - name: myapp-container
    image: busybox:1.28
    command: ['sh', '-c', 'echo The app is running! && sleep 3600']
  initContainers:
  - name: init-myservice
    image: busybox:1.28
    command: ['sh', '-c', 'until nslookup myservice; do echo waiting for myservice; sleep 2; done;']
  - name: init-mydb
    image: busybox:1.28
    command: ['sh', '-c', 'until nslookup mydb; do echo waiting for mydb; sleep 2; done;']
```
- 위 예시에서 init-myservice 컨테이너가 완료되야 init-mydb 컨테이너를 실행한다