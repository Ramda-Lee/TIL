# 쿠버네티스

## Kubernetes Secrets

### 개념
- ConfigMap: 일반 설정 데이터 저장(평문)
- Secret: 비밀번호, 키 등 민감 정보 저장(Base64 인코딩)

### Secret 생성 방법
1. 명령형
```
  kubectl create secret generic app-secret --from-literal=DB_HOST=MySql --from-literal=DB_USER=admin
```
- 파일로부터 생성도 가능(--from-file)

2. 선언형
```
  apiVersion: v1
  kind: Secret
  metadata:
    name: app-secret
  data:
    DB_HOST: bXlzcWw=
```
- 값은 반드시 base64로 인코딩 필요

### Secret 조회
- 목록 확인: kubectl get secrets
- 상세 확인(값 숨김): kubectl describe secret app-secret
- 값 포함 조회: kubectl get secret app-secret -o yaml
- Decoding: echo "bXlzcWw=" | base64 --decode

### Pod에서 사용
1. 환경 변수로 주입
```
  envFrom:
  - secretRef:
    name: app-secret
```
2. 볼륨으로 마운트
```
  volumes:
  - name: secret-volume
    secret:
      secretName: app-secret
```

### 보안 유의사항
- Secret은 암호화되지 않고 인코딩만 됨 -> 파일을 안다면 쉽게 디코딩 가능
- Secret 정의 파일은 공유 저장소(github 등)에 올리면 위험
- etcd에도 기본 암호화되지 않음 -> Encryotion at rest 설정 필요
- 네임스페이스 권한 있는 사용자는 Secret 접근 가능 -> RBAC 설정 필요
- 필요 시 AWS, Azure, GCP, Vault 같은 외부 Secret 관리 서비스 사용 권장